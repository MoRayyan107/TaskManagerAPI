<!DOCTYPE html>
<html>
<head>
    <title>Task List</title>
</head>
<body>
<h2>Your Tasks</h2>

<ul id="taskList"></ul>

<script>
    async function fetchTasks() {
        const token = localStorage.getItem("token");

        if (!token) {
            alert("No token found. Redirecting to login.");
            window.location.href = "/login";
            return;
        }

        const res = await fetch("/tasks", {
            method: "GET",
            headers: {
                "Authorization": "Bearer " + token
            }
        });

        if (res.ok) {
            const tasks = await res.json();
            const list = document.getElementById("taskList");
            if (!list) {
                console.error("Missing element with id='taskList'");
                return;
            }

            list.innerHTML = ""; // clear previous tasks
            tasks.forEach(task => {
                const li = document.createElement("li");
                li.textContent = task.title + " - " + task.description;
                list.appendChild(li);
            });

            console.log("Fetched tasks:", tasks); // âœ… move it inside
        } else if (res.status === 403 || res.status === 401) {
            alert("Session expired or access denied. Redirecting to login.");
            localStorage.removeItem("token");
            window.location.href = "/login";
        } else {
            alert("Error fetching tasks.");
        }
    }

    fetchTasks();
</script>
</body>
</html>
